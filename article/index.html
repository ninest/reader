<head>
  <title>Readable</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/themindstorm/readability-ui@latest/output/all.css">
  <link rel="stylesheet" href="../css/article.css">
</head>

<body>
  <main>
    <div class="metadata wrapper">
      <div id="domain">Loading domain ...</div>
      <h1 id="title">Loading title ...</h1>
      <div id="byline">
        <span id="date_published"></span>
        <span id="author"></span>
      </div>
    </div>

    <article id="content" class="wrapper">Loading content ...</article>
  </main>

  <script>

    let $title = document.querySelector('#title')
    let $domain = document.querySelector('#domain')
    let $author = document.querySelector('#author')
    let $datePublished = document.querySelector('#date_published')
    let $content = document.querySelector('#content')


    let articleUrl = document.location.href.split('#')[1]
    console.log(articleUrl)
    
    fetchArticle(articleUrl).then((response) => {
      console.log(JSON.stringify(response))
      setContent(response)
    }) 


    // functions
    async function fetchArticle(url) {
      // replaceing / with $$
      let escapedArticleUrl = url.replace(/\//g, "\$")

      return new Promise((resolve, reject) => {
        fetch('/api/content/' + escapedArticleUrl)
        .then((response) => {
          return response.json()
        })
        .then((json) => {
          console.log('JSON in function')
          console.log(json)
          resolve(json)
        })
      })
    }
    function setContent(articleJson) {
      $title.innerText = articleJson.title
      $content.innerHTML = articleJson.content

      $domain.innerText = articleJson.domain
      $author.innerText = articleJson.author
      $datePublished.innerText = articleJson.date_published
    }
</script>
</body>